{"version":3,"file":"index-70befa4c.js","sources":["../../../../pages/iris/index.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\n  import axios from 'axios';\r\n\r\n  definePageMeta({\r\n    layoutTransition: true,\r\n    middleware: defineNuxtRouteMiddleware((to, from) => {\r\n      return navigateTo('/innocence');\r\n    })\r\n  });\r\n\r\n  const userId = ref(null);\r\n  const room = ref([])\r\n  const dialogCreate = ref(false)\r\n  const formInput = ref();\r\n  const form = reactive({\r\n    name: '',\r\n    img: '',\r\n    type: 'GROUP',\r\n  })\r\n  const formJoin = reactive({\r\n    code: ''\r\n  })\r\n  const rules = ref([\r\n    (value: any) => {\r\n      if (value) return true\r\n      return 'Requred.'\r\n    },\r\n  ])\r\n  const flagAlert = ref('')\r\n  const textAlert = ref('')\r\n  const showAlert = ref(false)\r\n  const toggleCreate = ref(1)\r\n\r\n  const getListRoom = async () => {\r\n    const payload = {\r\n      userId: userId.value\r\n    }\r\n\r\n    await axios.post('http://127.0.0.1:8000/room/list', payload).then((res) => {\r\n      room.value = res.data.data;\r\n    }).catch((err) => {\r\n      throw new Error(err);\r\n    });\r\n  }\r\n\r\n  const toCreateGroup = async (type: number) => {\r\n    const check = await formInput.value?.validate();\r\n    \r\n    if (check.valid)\r\n      if (type === 1) {\r\n        const gen1 = btoa(form.name);\r\n        const gen2 = btoa('--EIR AOI--')\r\n        const gen3 = btoa(form.type);\r\n        const payload = {\r\n          ...form,\r\n          code: `${gen1}$${gen2}$${gen3}`,\r\n          userId: userId.value\r\n        }\r\n    \r\n        await axios.post('http://127.0.0.1:8000/room/create', payload).then((res) => {\r\n          flagAlert.value = res.data.statusCode === 200 ? 'success' : 'red';\r\n          textAlert.value = res.data.message;\r\n          showAlert.value = true;\r\n        }).catch((err) => {\r\n          throw new Error(err);\r\n        }).finally(() => {\r\n          dialogCreate.value = false;\r\n          getListRoom();\r\n          form.name = '';\r\n          form.img = '';\r\n          setTimeout(() => {\r\n            showAlert.value = false;\r\n          }, 1000);\r\n        })\r\n      } else {\r\n        const payload = {\r\n          ...formJoin,\r\n          type: 'GROUP',\r\n          userId: userId.value\r\n        }\r\n\r\n        await axios.post('http://127.0.0.1:8000/room/join', payload).then((res) => {\r\n          flagAlert.value = res.data.statusCode === 200 ? 'success' : 'red';\r\n          textAlert.value = res.data.message;\r\n          showAlert.value = true;\r\n        }).catch((err) => {\r\n          throw new Error(err);\r\n        }).finally(() => {\r\n          dialogCreate.value = false;\r\n          getListRoom();\r\n          formJoin.code = '';\r\n          setTimeout(() => {\r\n            showAlert.value = false;\r\n          }, 1000);\r\n        })\r\n      }\r\n  }\r\n\r\n  const toEnterGroup = (code: string) => {\r\n    location.href = `/iris/${code}`;\r\n  }\r\n\r\n  const toLeaveGroup = async (data: any) => {\r\n    const payload = {\r\n      name: data.name,\r\n      code: data.code,\r\n      type: data.type,\r\n      userId: data.user_id\r\n    }\r\n\r\n    await axios.post('http://127.0.0.1:8000/room/leave', payload).then((res) => {\r\n      flagAlert.value = res.data.statusCode === 200 ? 'success' : 'red';\r\n      textAlert.value = res.data.message;\r\n      showAlert.value = true;\r\n    }).catch((err) => {\r\n      throw new Error(err);\r\n    }).finally(() => {\r\n      getListRoom();\r\n    })\r\n  }\r\n\r\n  onMounted(() => {\r\n    const request = indexedDB.open('iris', 3);\r\n    request.onsuccess = (event: any) => {\r\n      const db = event.target.result;\r\n      const objectStore = db\r\n        .transaction(\"user\", \"readwrite\")\r\n        .objectStore(\"user\");\r\n  \r\n      objectStore.getAll().onsuccess = (event: any) => {\r\n        userId.value = event.target.result[0].user_id;\r\n      };\r\n    }\r\n\r\n    setTimeout(() => {\r\n      getListRoom()\r\n    }, 500);\r\n  })\r\n</script>\r\n\r\n<template>\r\n  <div class=\"containerz w-100 py-4\" style=\"position: relative;\">\r\n    <v-row class=\"w-100\">\r\n      <v-col cols=\"3\" v-for=\"(item, i) in room\" :key=\"i\" class=\"mb-3 list-group\">\r\n        <v-card class=\"elevation-3 card-group\">\r\n          <v-card-title class=\"headline text-primary\">\r\n            <b>{{ item.name }}</b>\r\n            <v-tooltip\r\n              location=\"top\"\r\n            >\r\n              <template v-slot:activator=\"{ props }\">\r\n                <v-icon class=\"icon-exit\" v-bind=\"props\" @click.prevent=\"toLeaveGroup(item)\">mdi-exit-run</v-icon>\r\n              </template>\r\n              <span>Exit</span>\r\n            </v-tooltip>\r\n          </v-card-title>\r\n\r\n          <v-divider></v-divider>\r\n\r\n          <v-card-text>\r\n            <img :src=\"item.img\" width=\"100%\" alt=\"\">\r\n            <v-btn class=\"mt-2\" block variant=\"outlined\" color=\"primary\" @click=\"toEnterGroup(item.code)\">Enter</v-btn>\r\n          </v-card-text>\r\n        </v-card>\r\n      </v-col>\r\n    </v-row>\r\n\r\n    <v-tooltip\r\n      location=\"top\"\r\n    >\r\n      <template v-slot:activator=\"{ props }\">\r\n        <v-btn color=\"success\" class=\"icon-add\" v-bind=\"props\" icon=\"mdi-plus\" @click=\"dialogCreate = true\"></v-btn>\r\n      </template>\r\n      <span>Create Group</span>\r\n    </v-tooltip>\r\n\r\n    <v-dialog\r\n      v-model=\"dialogCreate\"\r\n      transition=\"dialog-bottom-transition\"\r\n      width=\"30%\"\r\n    >\r\n      <v-card>\r\n        <v-toolbar\r\n          color=\"primary\"\r\n          :title=\"toggleCreate === 1 ? 'Create Group' : 'Join Group'\"\r\n        ></v-toolbar>\r\n        <v-card-text>\r\n          <v-btn-toggle\r\n            v-model=\"toggleCreate\"\r\n            color=\"primary\"\r\n            mandatory\r\n            density=\"compact\"\r\n            class=\"mb-4\"\r\n          >\r\n            <v-btn :value=\"1\">Create</v-btn>\r\n            <v-btn :value=\"2\">Join</v-btn>\r\n          </v-btn-toggle>\r\n\r\n          <v-form ref=\"formInput\" @submit.prevent=\"toCreateGroup(toggleCreate)\">\r\n            <!-- Create Group -->\r\n            <template v-if=\"toggleCreate === 1\">\r\n              <v-text-field\r\n                v-model=\"form.name\"\r\n                :rules=\"rules\"\r\n                label=\"Group name\"\r\n                variant=\"outlined\"\r\n                density=\"compact\"\r\n                class=\"mb-6\"\r\n                hide-details\r\n              ></v-text-field>\r\n              \r\n              <v-text-field\r\n                v-model=\"form.img\"\r\n                :rules=\"rules\"\r\n                label=\"Group image\"\r\n                variant=\"outlined\"\r\n                density=\"compact\"\r\n                class=\"mb-8\"\r\n                hide-details\r\n              ></v-text-field>\r\n            </template>\r\n            <!-- End Create Group -->\r\n\r\n            <!-- Join Group -->\r\n            <v-text-field\r\n              v-else\r\n              v-model=\"formJoin.code\"\r\n              :rules=\"rules\"\r\n              label=\"Group code\"\r\n              variant=\"outlined\"\r\n              density=\"compact\"\r\n              class=\"mb-6\"\r\n              hide-details\r\n            ></v-text-field>\r\n            <!-- End Join Group -->\r\n\r\n            <v-divider class=\"mb-4\"></v-divider>\r\n\r\n            <div class=\"text-right\">\r\n              <v-btn\r\n                color=\"warning\"\r\n                variant=\"outlined\"\r\n                class=\"mr-3\"\r\n                @click=\"dialogCreate = false\"\r\n              >Close</v-btn>\r\n              <v-btn\r\n                color=\"success\"\r\n                variant=\"outlined\"\r\n                type=\"submit\"\r\n              >Submit</v-btn>\r\n            </div>\r\n          </v-form>\r\n        </v-card-text>\r\n      </v-card>\r\n    </v-dialog>\r\n\r\n    <Snackbars\r\n      :flag=\"flagAlert\"\r\n      :text=\"textAlert\"\r\n      v-model=\"showAlert\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n  .list-group {\r\n    width: 300px;\r\n    height: 280px;\r\n  }\r\n\r\n  .card-group {\r\n    border-radius: 12px;\r\n  }\r\n\r\n  .icon-exit {\r\n    color: rgb(197, 94, 94);\r\n    font-size: 20px;\r\n    float: right;\r\n    margin-top: 6px;\r\n    cursor: pointer;\r\n  }\r\n\r\n  .icon-add {\r\n    position: absolute;\r\n    bottom: 12px;\r\n    right: 0px;\r\n  }\r\n</style>\r\n"],"names":[],"mappings":"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;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}